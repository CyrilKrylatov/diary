<!DOCTYPE html><html class="post"><head><meta charset="utf-8"><title>_kud.diary &#x2014; Every time you want to use ssh, macOS asks you your passphrase? This is the fix.</title><meta name="description" content="Diary of the _kud"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta property="og:title" content="Every time you want to use ssh, macOS asks you your passphrase? This is the fix."><meta property="og:image" content="http://diary.kud.io/images/macos-ssh-passphrase-keychain/cover.png"><link rel="shortcut icon" type="image/png" href="http://kud.io/favicon.png"><link rel="stylesheet" href="/index.css"></head><body><div class="kud-Banner"><script></script><a class="kud-Banner-link" href="/en/">Back to home</a></div><div class="kud-Wrapper"><section class="kud-Post kud-Text--wowLink animated fadeIn"><div class="kud-PostHeader"><span class="kud-PostHeader-decorator"><img class="kud-PostHeader-img" src="/images/macos-ssh-passphrase-keychain/cover.png"></span><div class="kud-PostHeader-overlay"><div class="kud-PostHeader-wrapper"><h2 class="kud-PostHeader-heading" id="every-time-you-want-to-use-ssh-macos-asks-you-your-passphrase-this-is-the-fix"><a class="kud-Anchor" href="#every-time-you-want-to-use-ssh-macos-asks-you-your-passphrase-this-is-the-fix"><span></span></a><a href="">Every time you want to use ssh, macOS asks you your passphrase? This is the fix.</a></h2><time class="kud-PostHeader-date hint--bottom" data-hint="2 years ago">Friday 1st December 2017</time></div></div></div><div class="kud-Post-content"><p>Since Sierra (macOS), I&#x2019;ve got this annoying question when I want to connect to a server via ssh:</p>
<pre><code class="hljs">$ ssh kud<span class="hljs-selector-class">.io</span>
Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&apos;/Users/kud/.ssh/id_rsa&apos;</span>:</code></pre>

<p>It asks you your passphrase.</p>
<p>Ugh? Usually it&#x2019;s saved in Keychain. But it doesn&#x2019;t work anymore.</p>
<p>However, there&#x2019;s a solution not to have to <code>$ ssh-add -K</code> every time you start a shell and want to connect with ssh.</p>
<p>Just add these lines to your <code>~/.ssh/config</code> line and it forces the SSH daemon to use Keychain.</p>
<pre><code class="hljs"><span class="hljs-string">Host</span> <span class="hljs-string">*</span>
  <span class="hljs-string">UseKeychain</span> <span class="hljs-literal">yes</span>
  <span class="hljs-string">AddKeysToAgent</span> <span class="hljs-literal">yes</span></code></pre>

<p>The reason is that the latest updates comes bundled with an <a href="https://developer.apple.com/library/content/technotes/tn2449/_index.html">updated OpenSSH package</a> that changes some default behaviour.</p>
<pre><code class="hljs html">Prior to macOS Sierra, ssh would present a dialog asking for your passphrase and would offer the option to store it into the keychain. This UI was deprecated some time ago and has been removed.

Instead, a new UseKeychain option was introduced in macOS Sierra allowing users to specify whether they would like for the passphrase to be stored in the keychain. This option was enabled by default on macOS Sierra, which caused all passphrases to be stored in the keychain.

This was not the intended default behavior, so this has been changed in macOS 10.12.2.
OpenSSH updates in macOS 10.12.2</code></pre>


</div></section><div class="kud-Footer kud-Text--wowLink"><ul class="kud-Footer-list"><li class="kud-Footer-listItem"><a class="kud-Footer-listLink" href="http://kud.io">Homepage</a></li><li class="kud-Footer-listItem"><a class="kud-Footer-listLink" href="http://instagram.kud.io">Instagram</a></li><li class="kud-Footer-listItem"><a class="kud-Footer-listLink" href="http://twitter.kud.io">Twitter</a></li><li class="kud-Footer-listItem"><a class="kud-Footer-listLink" href="/fr/">Je parle fran&#xE7;ais</a></li></ul></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71841668-1', 'auto');
ga('send', 'pageview');</script></body></html>